# Template file for 'signal-cli'
pkgname=signal-cli
version=0.6.8
revision=1
archs=noarch
hostmakedepends="asciidoc gradle openjdk8"
depends="virtual?java-runtime"
short_desc="Commandline and dbus interface for libsignal-service-java"
maintainer="Piraty <piraty1@inbox.ru>"
license="GPL-3.0-or-later"
homepage="https://github.com/AsamK/signal-cli"
distfiles="https://github.com/AsamK/signal-cli/archive/v${version}.tar.gz"
checksum=43463155418d47f11fcffc3b9231ab3f6296aee35b8c1ae0d7744822a124de37

do_build() {
	gradle -v build
	make -C man
}

do_install() {
	gradle installDist
}

post_install() {
	vmkdir usr/lib/signal-cli
	vcopy "build/install/signal-cli/lib/*" usr/lib/signal-cli

	# wrapper: adapt search path to our custom location
	vsed -i build/install/signal-cli/bin/signal-cli \
		-e "s,^APP_HOME=.*,APP_HOME=/usr/lib/signal-cli/," \
		-e "/^CLASSPATH/s,APP_HOME/lib,APP_HOME,g"

	vbin build/install/signal-cli/bin/signal-cli
	vman man/signal-cli.1
}
